# Dockerfile for running database migrations
FROM node:22-alpine

RUN apk add --no-cache libc6-compat openssl

WORKDIR /app

# Copy package files
COPY package.json package-lock.json ./
COPY prisma ./prisma/

# Install dependencies (using legacy-peer-deps to resolve ESLint conflicts)
RUN npm ci --legacy-peer-deps

# Generate Prisma Client
RUN npx prisma generate

# Copy seed files if needed
COPY scripts ./scripts/
COPY tsconfig.json ./

# Run migrations and seed
CMD ["sh", "-c", "npx prisma migrate deploy && npx prisma db seed"]
